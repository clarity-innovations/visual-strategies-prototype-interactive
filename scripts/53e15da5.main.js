if(!(console&&console.log&&console.trace&&console.debug)){var console={};console.log=function(){},console.trace=function(){},console.debug=function(){}}var np=np||{};np.App=function(){"use strict";function a(){P(),j(),g(),ta=$("#workspace"),$("#workspace").on("mousedown pointerdown",b).on("touchstart",function(a){b(e(a))}),ta.on("mousedown pointerdown",".piece",function(a){r(a)}).on("mouseup touchend pointerup",c).on("mousemove pointermove",d).on("touchmove",function(a){d(e(a))}),createjs.Touch.enable(Ha),createjs.Ticker.on("tick",f),h(),np.Workspace.init(),np.Drawtool.init(),k(),Ha.on("drawmodeon",S),Ha.on("drawmodeoff",T),aa=$("*").length,G(),sa.scrollLeft((ca-ea)/2).scrollTop((da-fa)/2),window.addEventListener("mouseup",function(a){a.clientX<1||a.clientY<1||a.clientX>$(window).width()||a.clientY>$(window).height()?M():(la||ka||Y)&&(a.clientY>ha||a.clientX<ia)&&M()}),$("#infopage .close").click(function(){$("#infopage").fadeOut()});var a=[{x:70,y:313},{x:110,y:253},{x:100,y:347},{x:170,y:330},{x:226,y:303},{x:271,y:229},{x:291,y:309},{x:322,y:285},{x:345,y:267},{x:380,y:340},{x:440,y:288},{x:462,y:315}];_.each(a,function(a){i("tile",{x:a.x,y:a.y})})}function b(a){var b=p(a);return b?void r(a,b):ma?!1:void(1!=a.which||Y||0==oa&&($("#workspace .selected").removeClass("selected"),D(a)))}function c(a){if(ma)return!1;if(ra&&w(),!wa){var b=p(a),c=$(b);c.hasClass("piece")&&c.addClass("selected"),G()}Y=null,clearInterval(Ja),Z=null,ra=!1,wa=!1,G(),$(".trayBtn").removeClass("down"),xa=!0,a.stopPropagation()}function d(a){return ma?!1:0==a.which&&"touchmove"!=a.originalEvent.type&&Y?void $(this).mouseup():(t(a),void a.stopPropagation())}function e(a){var b=a.originalEvent.touches[0];return a.clientX=b.clientX,a.clientY=b.clientY,a.pageX=b.pageX,a.pageY=b.pageY,a.screenX=b.screenX,a.screenY=b.screenY,a}function f(){Ka.update&&(Ha.update(),Ka.update=!1)}function g(){ea=$(window).width()-ia,ea=400,fa=$(window).height()-$("#toolbar").height(),fa=535,sa=$("#scrollView"),sa.on("touchstart",function(a){D(e(a))}).on("scroll",function(a){}).on("mousemove",function(a){return ma?!1:$(a.target).hasClass("piece")?!1:void t(a)}).on("touchmove",function(a){return ma?!1:$(a.target).hasClass("piece")?!1:void t(e(a))}).on("mouseup touchend pointerup",function(a){return ma?!1:(clearInterval(Ja),Y?(Y.addClass("selected"),"workspace"!=a.target.id&&Y.mouseup()):($("#workspace .selected").removeClass("selected"),"touchend"==a.originalEvent.type&&F(a)),Y=null,void G())}),ga=sa[0].clientWidth-1,ha=sa[0].clientHeight-1}function h(){$("#reset_Btn").on("click",function(a){$(this).hasClass("disabled")||A()}),$("#unGroup_Btn").on("click",function(a){$(this).hasClass("disabled")||z(a)}),$("#group_Btn").on("click",function(a){$(this).hasClass("disabled")||y(a)}),$(".colorBtn").on("click",function(a){$(this).hasClass("disabled")||H(a)}),$(".zoomBtn").on("click",function(a){$(this).hasClass("disabled")||I(a)}),$("#rotate_Btn").on("click",function(a){$(this).hasClass("disabled")||x(a)}),$("#duplicate_btn").on("click",function(a){$(this).hasClass("disabled")||m()}),$(".deleteBtn").on("click",function(a){$(this).hasClass("disabled")||C(a)}),La.info=new U($("#info_Btn")),La.info.$button.click(function(){$("#infopage").fadeIn(),$("#infopage .contents-wrapper").scrollTop(0)}),$("#infopage .close").click(function(){$("#infopage").fadeOut()}),$("#infopage .title").click(function(){var a=$(this);a.hasClass("info_selected")||($("#infopage .title.info_selected").removeClass("info_selected"),a.addClass("info_selected"),$("#infopage .contents").toggle(),$("#infopage .contents-wrapper").scrollTop(0))}),La.calculation=new U($("#calculation")),La.calculation.$button.on("click",function(){if(La.calculation.enabled){np.Drawtool.setDrawMode();var a=np.Workspace.selection.find(np.Calculation);if(a.length){var b=a[0];np.Workspace.selection.set([b]),b.edit(),G()}else $("#workspace .selected").removeClass("selected"),np.Workspace.addCalculation(qa),G()}});var a=new U($("#drawing"));a.$button.on("click",function(){np.Drawtool.toggle()}),Ha.on("drawtoolopen",Q,a),Ha.on("drawtoolclose",R,a)}function i(a,b){var c=b.x,d=b.y,e=!1;Z={x:c,y:d,typeOfPiece:a,rotate:e},l(),$("#workspace .selected").removeClass("selected")}function j(){$(".trayBtn").on("mousedown touchstart",function(a){if(a.preventDefault(),!$(this).hasClass("disabled")){$(this).addClass("down");for(var b=$(this).attr("shape"),c=!1,d=sa.scrollLeft()+10;!c;){var e=!1;$("."+b).each(function(){$(this).position().left==d&&(e=!0)}),e?d+=10:c=!0}for(var f=!1,g=sa.scrollTop()+$(a.target).position().top;!f;){var h=!1;$("."+b).each(function(){$(this).position().top==g&&(h=!0)}),h?g+=10:f=!0}var i=!1;($(this).is("#strip_horz_btn")||$(this).is("#edge_horz_btn"))&&(i=!0),$("#workspace .selected").removeClass("selected"),Z={x:d,y:g,typeOfPiece:b,rotate:i},np.Workspace.selection.deselect()}}).on("mouseup touchend",function(a){a.preventDefault(),Z&&l(),Z=null,$(this).removeClass("down")}).on("mousemove",function(a){})}function k(){X=Ga.getContext("2d"),$(Ga).on("wk_mousemove",function(a){return a.preventDefault(),ma?!1:void E(a)}).on("wk_touchmove",function(a){return a.preventDefault(),ma?!1:void E(e(a))}).on("mouseup touchend pointerup",function(a){return a.preventDefault(),ma?!1:void(ka&&F(a))}),X.setLineDash||(X.setLineDash=function(){})}function l(){aa++;var a="edge"==Z.typeOfPiece?"white":"yellow",b=document.createElement("canvas");$(b).css({left:Z.x,top:Z.y}).addClass(Z.typeOfPiece+" piece selected "+a).attr("orientation","strip"==Z.typeOfPiece?2:1),"edge"==Z.typeOfPiece&&Z.rotate&&$(b).attr("orientation",4);var c=ba*qa;if(b.width="tile"==Z.typeOfPiece||"strip"==Z.typeOfPiece?c:10*c,"edge"==Z.typeOfPiece&&(b.width=11*c),b.height="tile"==Z.typeOfPiece||"edge"==Z.typeOfPiece?c:10*c,Z.rotate){var d=b.height;b.height=b.width,b.width=d}return aa++,$(b).css("z-index",aa),$("#workspace").append(b),W=0,n($(b)),G(),Z=null,$(b)}function m(){var a=$(".piece.selected");$("#workspace .selected").removeClass("selected");var b,c,d,e=[];wa=!0,$.each(a,function(a,f){d=!1,c="yellow";var g=$(f);g.hasClass("edge")?(b="edge",c="white",d=!0):g.hasClass("tile")?b="tile":g.hasClass("strip")?(b="strip",d=!0):b="mat","edge"!=b&&(g.hasClass("green")?c="green":g.hasClass("red")&&(c="red"));var h=document.createElement("canvas");$(h).css({left:$(f).position().left+10,top:$(f).position().top+10}).addClass(b+" piece selected "+c).attr("orientation","strip"==b?2:1);var i=ba*qa;if(h.width="tile"==b||"strip"==b?i:10*i,h.height="tile"==b||"edge"==b?i:10*i,aa++,$(h).css("zIndex",aa),$("#workspace").append(h),W=0,n($(h)),e.push(h),d){var j=$(h),k=L(g,"parent");j.width(k.width),h.width=k.width,j.height(k.height),h.height=k.height,j.attr("orientation",g.attr("orientation")),n(j)}}),$.each(e,function(a,b){$(b).addClass("selected")});var f=np.Workspace.selection.find(np.Calculation);np.Workspace.selection.deselect(),$.each(f,function(a,b){var c=b.duplicate();np.Workspace.selection.append([c])}),G()}function n(a){if(a){if(a.hasClass("edge"))return void o(a);var b=ba*qa,c=Math.ceil(2*qa),d=Math.ceil(1*qa),e=a.width(),f=a.height(),g=a[0].getContext("2d");g.clearRect(0,0,e,f);for(var h=e/b,i=Math.floor(f/b),j=1;h+1>j;j++){var k=f;g.beginPath(),j%5==0?(g.lineWidth=c,g.strokeStyle=Aa):(g.lineWidth=d,g.strokeStyle=ya),g.moveTo(j*b,0),g.lineTo(j*b,k),g.stroke()}for(var j=1;i+1>j;j++){var l=e;g.beginPath(),j%5==0?(g.lineWidth=c,g.strokeStyle=Aa):(g.lineWidth=d,g.strokeStyle=ya),g.moveTo(e,f-j*b),g.lineTo(e-l,f-j*b),g.stroke()}g.beginPath(),g.lineWidth=c,g.strokeStyle=za,g.strokeRect(0,0,e,f),g.strokeRect(0,0,e,f),g.strokeRect(0,0,e,f),g.strokeRect(0,0,e,f)}}function o(a){var b=a[0].getContext("2d");b.fillStyle=Fa;var c=ba*qa,d=a.attr("orientation"),e=2*qa,f=1*qa,g=Math.max(a.width(),a.height()),h=Math.min(a.width(),a.height());b.clearRect(0,0,a.width(),a.height()),b.strokeStyle=Ca;var i=Math.ceil(g/c);switch(b.save(),d){case"1":break;case"2":b.translate(0,a.height()),b.rotate(-Math.PI/2);break;case"3":b.translate(a.width(),c),b.rotate(Math.PI);break;case"4":b.translate(c,0),b.rotate(Math.PI/2)}b.lineWidth=e,b.strokeStyle=Ca,b.moveTo(0,c/2),b.lineTo(c*(i-1),c/2),b.stroke();for(var j=0;i>j;j++){var k=c;j%5==0?(b.lineWidth=e,j%10==0?b.strokeStyle=Ea:b.strokeStyle=Da):(b.lineWidth=f,b.strokeStyle=Ca),b.beginPath(),b.moveTo(j*c,0),b.lineTo(j*c,k),b.moveTo(j*c,c),b.lineTo(j*c,c-k),b.stroke()}switch(b.strokeStyle=Ba,b.beginPath(),b.lineWidth=e,b.moveTo(g,0),b.lineTo(0,0),b.lineTo(0,h),b.lineTo(g,h),b.restore(),b.save(),parseInt(d)){case 1:b.translate(a.width(),c),b.rotate(Math.PI);break;case 2:b.translate(c,0),b.rotate(Math.PI/2);break;case 3:break;case 4:b.translate(0,a.height()),b.rotate(-Math.PI/2)}var l=c/ba,m=2.2*l,n=7*l,o=6*l+5,p=20*l;b.strokeStyle="rgba(0, 0, 0, 0)",b.lineWidth=0,b.beginPath();var q=c/2;b.moveTo(4,q),b.lineTo(o,q-n),b.lineTo(o,q-m),b.lineTo(p,q-m),b.lineTo(p,q+m),b.lineTo(o,q+m),b.lineTo(o,q+n),b.lineTo(4,q),b.fill(),b.restore()}function p(a){var b=$(q(a.clientX,a.clientY)).filter(".piece"),c=void 0;return $.each(b,function(a,b){(!c||$(b).css("z-index")>$(c).css("z-index"))&&(c=b)}),c}function q(a,b){var c,d=[],e=[];if(a&&b){for(;;){if(c=document.elementFromPoint(a,b),!c||c===document.documentElement)break;d.push(c),e.push(c.style.visibility),c.style.visibility="hidden"}for(var f=0;f<d.length;f++)d[f].style.visibility=e[f];d.reverse()}return d}function r(a,b){a.preventDefault();var c=$(b);return ma?!1:(c.hasClass("piece")&&(Y=c),Y.hasClass("selected")||($("#workspace .selected").removeClass("selected"),Y.addClass("selected"),G()),na={x:a.clientX,y:a.clientY},Y.css("zIndex",aa),aa++,V=Y.offset().top-a.clientY,W=Y.offset().left-a.clientX,void a.stopPropagation())}function s(a,b){var c=L($("#workspace .selected"),"parent"),d=10;ua={x:0,y:0},"left"==a&&c.left>0?ua.x=-1:"right"==a&&c.right<ta.width()?ua.x=1:"up"==a&&c.top>0?ua.y=-1:"down"==a&&c.bottom<ta.height()&&(ua.y=1),$("#workspace .selected").each(function(){var a=$(this).offset();$(this).offset({left:a.left+ua.x,top:a.top+ua.y})}),na={x:b.x+ua.x,y:b.y+ua.y},"left"==a||"right"==a?sa.scrollLeft(sa.scrollLeft()+ua.x):("down"==a||"up"==a)&&(ua.x=0,sa.scrollTop(sa.scrollTop()+ua.y)),clearInterval(Ja);var e=!0;c=L($("#workspace .selected"),"parent"),("left"==a&&c.left<=0||"right"==a&&c.right>=ta.width()||"up"==a&&c.top<=0||"down"==a&&c.bottom>=ta.height())&&(e=!1),e&&(Ja=setInterval(function(){s(a,b,!0)},d))}function t(a){if(!Y)return void(Z&&(xa=!1,u(a)));wa=!0;var b={x:a.clientX,y:a.clientY};if(clearInterval(Ja),Y.hasClass("edge")&&a.clientX>ia+15&&xa){if(v(a))return;if(ra)return}else xa=!1;var c=null,d={x:!0,y:!0};ua={x:b.x-na.x,y:b.y-na.y},c=L($("#workspace .selected"),"parent");var e=b.y+V,f=b.x+W,g=e+Y.height(),h=f+Y.width();if($(".piece").each(function(a){var b=L($(this),"screen");Math.abs(b.top-g)<=ja&&(f>=b.left&&f<b.right||f<=b.left&&h>b.left)&&(e=b.top-Y.height(),Math.abs(f-b.left)<=ja?f=b.left:Math.abs(h-b.right)<=ja&&(f=b.right-Y.width())),Math.abs(b.left-h)<=ja&&(e>=b.top&&e<b.bottom||e<=b.top&&g>b.top)&&(f=b.left-Y.width(),Math.abs(e-b.top)<=ja?e=b.top:Math.abs(g-b.bottom)<=ja&&(e=b.bottom-Y.height())),Math.abs(e-b.bottom)<=ja&&(f>=b.left&&f<b.right||f<=b.left&&h>b.left)&&(e=b.bottom,Math.abs(f-b.left)<=ja?f=b.left:Math.abs(h-b.right)<=ja&&(f=b.right-Y.width())),Math.abs(f-b.right)<=ja&&(e>=b.top&&e<b.bottom||e<=b.top&&g>b.top)&&(f=b.right,Math.abs(e-b.top)<=ja?e=b.top:Math.abs(g-b.bottom)<=ja&&(e=b.bottom-Y.height()))}),ua.x=f-Y.offset().left,c.right+ua.x>ta.width()&&ua.x>0&&(ua.x=ta.width()-c.right),c.left<0-ua.x&&ua.x<0&&(ua.x=0-c.left),ua.y=e-Y.offset().top,c.bottom+ua.y>ta.height()&&ua.y>0&&(ua.y=ta.height-c.bottom),c.top<0-ua.y&&ua.y<0&&(ua.y=0-c.top),$("#workspace .selected").each(function(){var a=$(this).offset();$(this).offset({left:a.left+ua.x,top:a.top+ua.y})}),na={x:d.x?a.clientX:na.x,y:d.y?a.clientY:na.y},c=L($("#workspace .selected"),"screen"),1==qa&&c.width<sa.width()&&c.height<sa.height()){c=L($("#workspace .selected"),"parent");var i="",j=sa.scrollLeft(),k=sa.scrollTop();if(c.right>j+sa[0].clientWidth-10&&ua.x>=0?(i="right",sa.scrollLeft(c.right-sa[0].clientWidth)):c.left<j&&ua.x<=0?(i="left",sa.scrollLeft(c.left)):c.bottom>k+sa[0].clientHeight&&ua.y>=0?(i="down",sa.scrollTop(c.bottom-sa[0].clientHeight)):c.top<k&&ua.y<=0&&(c.top>0&&(i="up"),sa.scrollTop(c.top)),""==!i)return void(Ja=setInterval(function(){s(i,b,!0)},300))}ua={x:0,y:0},a.cancelBubble=!0,a.stopPropagation()}function u(a){return 0==!oa?void G():(Y=l(),na={x:a.clientX,y:a.clientY},V=ba/-2,void(W=-10))}function v(a){var b=L(Y,"screen"),c=!1,d=ba*qa;switch(ua={x:a.clientX-na.x,y:a.clientY-na.y},parseInt(Y.attr("orientation"))){case 1:Y[0].width+ua.x<d&&(ua.x=0),(ra||a.clientX>b.right-d)&&(Y[0].width+=ua.x,Y.width(Y[0].width),c=!0);break;case 2:Y[0].height-ua.y<d&&(ua.y=0),(ra||a.clientY<b.top+d)&&(Y[0].height-=ua.y,Y.height(Y[0].height),Y.offset({top:Y.offset().top+ua.y}),c=!0);break;case 3:Y[0].width-ua.x<d&&(ua.x=0),(ra||a.clientX<b.left+d)&&(Y[0].width-=ua.x,Y.width(Y[0].width),Y.offset({left:Y.offset().left+ua.x}),c=!0);break;case 4:Y[0].height+ua.y<d&&(ua.y=0),(ra||a.clientY>b.bottom-d)&&(Y[0].height+=ua.y,Y.height(Y[0].height),c=!0)}return c?(na={x:a.clientX,y:a.clientY},n(Y),setTimeout(function(){n(Y)},10),ra=!0,!0):(ra=!1,xa=!1,!1)}function w(){var a,b=L(Y,"document"),c=1==qa?ba:ba*qa;switch(parseInt(Y.attr("orientation"))){case 1:a=Math.floor(b.width/c)*c,a=a>=c?a:c,Y[0].width=a,Y.width(Y[0].width);break;case 2:a=Math.floor(b.height/c)*c,a=a>=c?a:c,a=Math.floor(a),Y[0].height=a,Y.height(Y[0].height),Y.offset({top:b.top+(b.height-a)});break;case 3:a=Math.floor(b.width/c)*c,a=a>=c?a:c,a=Math.floor(a),Y[0].width=a,Y.width(Y[0].width),Y.offset({left:b.left+(b.width-a)});break;case 4:a=Math.floor(b.height/c)*c,a=a>=c?a:c,Y[0].height=a,Y.height(Y[0].height)}var d=Y[0];n($(d),!0),setTimeout(function(){n($(d))},10)}function x(){var a=L($("#workspace .selected"),"parent");$(".selected.strip,.selected.edge").each(function(){var a=$(this),b=L(a,"parent");a.width(b.height),this.width=b.height,a.height(b.width),this.height=b.width,K(a,b.center.x,b.center.y);var c=parseInt(a.attr("orientation"));c--,1>c&&(c=4),a.attr("orientation",c),n(a),setTimeout(function(){n(a)},10)}),$("#workspace .selected").each(function(){var b=$(this),c=L(b,"parent"),d=a.center.y-(a.center.x-c.center.x);d=Math.max(d,c.height/2),d=Math.min(d,ta.height()-c.height/2);var e=a.center.x+(a.center.y-c.center.y);e=Math.max(e,c.width/2),e=Math.min(e,ta.width()-c.width/2),K(b,e,d)})}function y(){for(var a=1,b=$(".tile.selected:lt(10)").sort(function(b,c){return a?+parseInt(b.style.left)-+parseInt(c.style.left):+parseInt(c.style.left)-+parseInt(b.style.left)});b.length>9;){var c=L(b,"parent");Z={x:0,y:0,typeOfPiece:"strip"};var d=l();if(K(d,c.center.x,c.center.y),b.remove(),d.addClass("newStrip").removeClass("selected"),c.width>c.height){var e,f,g=J(d);e=10*ba,f=ba,1!=qa?(e=Math.floor(e*qa),f=Math.floor(f*qa),d.width(e).height(f),d[0].width=e,d[0].height=f):(d.width(e).height(f),d[0].width=e,d[0].height=f),K(d,g.x,g.y),n(d)}b=$(".tile.selected:lt(10)").sort(function(b,c){return a?+parseInt(b.style.left)-+parseInt(c.style.left):+parseInt(c.style.left)-+parseInt(b.style.left)})}for(var h=$(".strip.selected:lt(10)").sort(function(b,c){return a?+parseInt(b.style.top)-+parseInt(c.style.top):+parseInt(c.style.top)-+parseInt(b.style.top)});h.length>9;){var c=L(h,"parent");Z={x:0,y:0,typeOfPiece:"mat"};var i=l();K(i,c.center.x,c.center.y),h.remove(),i.addClass("newMat").removeClass("selected"),h=$(".strip.selected:lt(10)").sort(function(b,c){return a?+parseInt(b.style.left)-+parseInt(c.style.left):+parseInt(c.style.left)-+parseInt(b.style.left)})}$(".newStrip").addClass("selected").removeClass("newStrip"),$(".newMat").addClass("selected").removeClass("newMat"),G()}function z(a){var b,c,d=$(".selected.strip"),e=$(".selected.mat");d.each(function(a){for(var d=$(this).width()<$(this).height(),e=$(this).position(),f=0;10>f;f++)d?(b=e.left,c=e.top+f*ba*qa):(c=e.top,b=e.left+f*ba*qa),Z={x:b,y:c,typeOfPiece:"tile"},l();$(this).remove()}),e.each(function(a){for(var b=$(this).position(),c=0;10>c;c++)Z={x:b.left+c*ba*qa,y:b.top,typeOfPiece:"strip"},l();$(this).remove()}),G()}function A(){O("Do you want to clear all your work?","Start Over?",function(){B()})}function B(){$(".piece").remove(),va=!1,1!=qa&&I(),ta.height(da),ta.width(ca),$(".zoomBtn").removeClass("out"),np.Drawtool.eraseAll(),np.Drawtool.close(),np.Workspace.deleteAll(),G()}function C(){$("#workspace .selected").remove(),np.Workspace.deleteSelection(),G()}function D(a){return}function E(a){if(!ka)return!1;if(0==a.which&&"mousemove"==a.originalEvent.type&&F(a),"undefined"==typeof a.offsetX||"undefined"==typeof a.offsetY){var b=$(a.target).offset();a.offsetX=a.pageX-b.left,a.offsetY=a.pageY-b.top}na={x:a.offsetX,y:a.offsetY},1!=qa&&(na.x=na.x/qa,na.y=na.y/qa),Ia.graphics.lineTo(na.x,na.y),Ka.update=!0,a.stopPropagation()}function F(a){ka=!1,Ia.graphics.closePath(),Ha.updateContext(X),$(".piece").each(function(a){var b=J($(this));X.isPointInPath(b.x,b.y)?($(this).addClass("selected"),aa++,$(this).css("z-index",aa)):$(this).removeClass("selected")}),$("body").css("cursor","default"),Ia&&Ia.graphics.clear(),Ka.update=!0,G(),a.stopPropagation()}function G(){$(".trayBtn, #toolbar .button").removeClass("disabled down"),$("#toolbar .button").addClass("disabled"),Ka.drawMode?$(".trayBtn").addClass("disabled"):($("#workspace .selected").length>0&&$(".deleteBtn, .resetBtn, .colorBtn, .rotateBtn, #duplicate_btn").removeClass("disabled"),$(".selected.edge").length>0&&$(".selected.edge").length==$("#workspace .selected").length&&$(".colorBtn").addClass("disabled"),($(".selected.strip").length>=1||$(".selected.mat").length>=1)&&$(".unGroupBtn").removeClass("disabled"),($(".strip.selected").length>9||$(".tile.selected").length>9)&&$(".groupBtn").removeClass("disabled"),$(".piece").length>0&&$(".resetBtn").removeClass("disabled"),np.Workspace.selection.find(np.Calculation).length>0&&$("#duplicate_btn, .deleteBtn").removeClass("disabled")),$("#reset_Btn, .infoBtn, .zoomBtn, #calculation, #drawing").removeClass("disabled"),$("#drawingmenu").is(":visible")&&$("#drawing").addClass("on")}function H(a){if(!$(a.target).hasClass("disable")){var b=$(a.target),c=b.attr("id").split("_")[1];$("#workspace .selected").removeClass("red yellow green").addClass(c)}}function I(){if(1==qa)qa=pa,$(".piece").each(function(a){var b=$(this).position();this.width=this.width*qa,$(this).width(this.width),this.height=this.height*qa,$(this).height(this.height);var c=b.left*qa,d=b.top*qa;$(this).css({left:c,top:d})}),ta.height(da*qa),ta.width(ca*qa),ta.width()==sa.width()&&sa.css("overflow","hidden"),np.Workspace.zoom(qa,"out"),$(".zoomBtn").addClass("out"),Ha.scaleX=qa,Ha.scaleY=qa;else{$(".piece").each(function(a){var b=$(this).position();this.width=this.width/qa+1,$(this).width(this.width),this.height=this.height/qa+1,$(this).height(this.height);var c=b.left/qa+1,d=b.top/qa+1;$(this).offset({left:c,top:d}),$(this).css({left:c,top:d})}),ta.height(da),ta.width(ca),np.Workspace.zoom(qa,"in"),qa=1,Ha.scaleX=qa,Ha.scaleY=qa;var a=L($("#workspace .selected"),"parent");sa.css("overflow","auto"),0==$("#workspace .selected").length?sa.scrollLeft((ca-ea)/2).scrollTop((da-fa)/2):sa.scrollLeft(a.left-(sa.width()-a.width)/2).scrollTop(a.top-(sa.height()-a.height)/2),$(".zoomBtn").removeClass("out")}Ha.update(),$("#canvas").width(ta.width()).height(ta.height()),Ga.width=$("#canvas").width(),Ga.height=$("#canvas").height(),Ka.update=!0,$(".piece").each(function(a){n($(this))}),setTimeout(function(){$(".piece").each(function(a){n($(this))})},1),G()}function J(a){var b=a.position(),c={x:b.left+a.width()/2,y:b.top+a.height()/2};return c}function K(a,b,c){a.css({left:b-a.width()/2,top:c-a.height()/2})}function L(a,b){var c=1e4,d=0,e=1e4,f=0;a.each(function(a){var g="parent"==b?$(this).position():$(this).offset(),h=$(this).width(),i=$(this).height();c=Math.min(c,g.left),d=Math.max(d,g.left+h),e=Math.min(e,g.top),f=Math.max(f,g.top+i)});var g={x:c+(d-c)/2,y:e+(f-e)/2};return{left:c,top:e,right:d,bottom:f,center:g,width:d-c,height:f-e}}function M(){la?$(".drawingCanvas").mouseup():Y?Y.mouseup():ka&&$(".selectingCanvas").mouseup(),G()}function N(a,b,c){b=b?b:"";var d=$(".dialog-modal-template").clone();d.removeClass("dialog-modal-template").addClass("dialog-modal"),d.html(a),d.attr("title",b),d.dialog({draggable:!1,resizable:!1,modal:!0,minHeight:30,dialogClass:"alert",buttons:[{text:"Ok",click:function(){$(this).dialog("destroy")}}]}),_.each(c,function(a,b){d.dialog("option",b,a)})}function O(a,b,c){var d={};d.dialogClass="alert confirm",d.buttons=[{text:"No",click:function(){$(this).dialog("destroy")}},{text:"Yes",click:function(){c(),$(this).dialog("destroy")}}],N(a,b,d)}function P(){$(".no-select").attr("unselectable","on").attr("draggable","false").on("dragstart",function(){return!1}),$(".no-select").find("*").attr("draggable","false").attr("unselectable","on")}function Q(){this.$button.addClass("on").addClass("down"),np.Drawtool.setDrawMode("freehand"),G()}function R(){this.$button.removeClass("on").removeClass("down"),G()}function S(){Ka.drawMode=!0,$("body").addClass("drawmode"),G()}function T(){Ka.drawMode=!1,$("body").removeClass("drawmode"),G()}function U(a){var b=this;b.$button=a,b.enabled=a.hasClass("enabled"),b.enable=function(a){b.enabled=a,a?(b.$button.removeClass("disabled"),b.$button.addClass("enabled")):(b.$button.addClass("disabled"),b.$button.removeClass("enabled"))}}var V,W,X,Y=null,Z=null,aa=0,ba=28,ca=0,da=0,ea=0,fa=0,ga=0,ha=0,ia=$(".tray").width(),ja=8,ka=!1,la=!1,ma=!1,na=null,oa=0,pa=.48,qa=1,ra=!1,sa=null,ta=null,ua=null,va=!1,wa=!1,xa=!0,ya=($("#toolbar").height(),"rgba(0, 0, 0, .25)"),za="rgba(0, 0, 0, 1)",Aa="rgba(0, 0, 0, .33)",Ba="#F7F7F7",Ca="#A7A7A7",Da="#737373",Ea="#000000",Fa="#0E81C6",Ga=document.getElementById("canvas");k();var Ha=new createjs.Stage(Ga);Ha.name="stage",Ha.mouseMoveOutside=!0;var Ia,Ja,Ka={update:!1,mouse:{down:!1,lastClick:{x:0,y:0}},drawMode:!1,proxyTarget:null,workspaceOrigin:{x:0,y:0},iPad:navigator.userAgent.match(/(iPad)/g)?!0:!1},La={},Ma={init:a,stage:Ha,canvas:Ga,state:Ka,zoomRatio:qa,zoomConstant:pa,fillPiece:n,confirmMessage:O};return Ma}();var np=np||{};np.Drawtool=function(a,b,c){"use strict";function d(){var b=this;b.state={open:!1,drawMode:null,drawColor:"red",drawing:!1},b.d=new createjs.Container,b.d.name="draw",b.d.cache(0,0,np.App.canvas.width,np.App.canvas.height),a.addChild(b.d),b.drawing=new createjs.Shape,b.drawing.name="drawShape",b.d.addChild(b.drawing),b.lastPoint=new createjs.Point,$("#closeDrawingMenu").click(function(a){a.preventDefault(),b.close()}),$("#penCurve").click(function(a){a.preventDefault(),"freehand"===b.state.drawMode?b.setDrawMode():b.setDrawMode("freehand")}),$("#penStraight").click(function(a){a.preventDefault(),"line"===b.state.drawMode?b.setDrawMode():b.setDrawMode("line")}),$("#penColor").click(function(a){a.preventDefault(),$("#drawingmenu .colorPicker").switchClass("closed","open",400,"linear")}),$("#drawingmenu .colorPicker li").click(function(a){a.preventDefault();var c=$(this);$("#drawingmenu .colorPicker li.dt_selected").removeClass("dt_selected"),_.each(q,function(a,d){c.hasClass(d)&&(b.setColor(d),c.addClass("dt_selected"),$("#drawingmenu .colorPicker").switchClass("open","closed",400,"linear"))})}),$("#eraser").click(function(a){a.preventDefault(),"eraser"===b.state.drawMode?b.setDrawMode():b.setDrawMode("eraser")}),$("#clearDrawing").click(function(a){a.preventDefault(),np.App.confirmMessage("Clear all drawing?","",function(){b.eraseAll()})}),a.on("resize",m,np.Drawtool),a.on("tick",n,np.Drawtool)}function e(){var a=this;a.state.open?a.close():a.open()}function f(){var b=this;b.state.open=!0,b.$menu.show(),b.d.visible=!0,a.dispatchEvent("drawtoolopen"),np.App.state.update=!0}function g(){var b=this;b.state.open=!1,b.$menu.hide(),b.d.visible=!1,b.setDrawMode(null),a.dispatchEvent("drawtoolclose"),a.dispatchEvent("drawmodeoff"),np.App.state.update=!0}function h(a){var b=this,c=_.keys(q).join(" ");b.state.drawColor=a,$("#penCurve").removeClass(c).addClass(a),$("#penStraight").removeClass(c).addClass(a)}function i(b){var c=this;switch(o.find("#penCurve, #penStraight, #eraser").removeClass("dt_selected"),c.d.addChild(c.drawing),b){case"freehand":c.state.drawMode="freehand",$("#penCurve").addClass("dt_selected"),a.dispatchEvent("drawmodeon");break;case"line":c.state.drawMode="line",$("#penStraight").addClass("dt_selected"),a.dispatchEvent("drawmodeon");break;case"eraser":c.state.drawMode="eraser",$("#eraser").addClass("dt_selected"),a.dispatchEvent("drawmodeon");break;default:c.state.drawMode=null,a.dispatchEvent("drawmodeoff")}}function j(c,d,e){var f,g,h=this;f=d?c.x:c.x/p,g=d?c.y:c.y/p;var i,j,k;if(h.state.drawing===!1){h.state.drawing=!0,h.lastPoint.x=f,h.lastPoint.y=g;var l=np.App.canvas.getContext("2d");l.setLineDash||(l.setLineDash=function(){}),l.lineWidth=6,l.webkitLineDash=[],l.setLineDash([]),l.mozDash=[],a.updateContext(l)}switch(h.state.drawMode){case"freehand":i=q[h.state.drawColor],j=5,k="source-over";break;case"line":i=q[h.state.drawColor],j=5,k="source-over";break;case"eraser":i=createjs.Graphics.getRGB(0,0,0,1),j=52,k="destination-out"}if(h.lastPoint.mouseInBounds||a.mouseInBounds||e){"line"===h.state.drawMode&&h.drawing.graphics.clear(),h.drawing.graphics.setStrokeStyle(j,"round","round").beginStroke(i);var m=h.lastPoint.x>b.workspaceOrigin.x?h.lastPoint.x:b.workspaceOrigin.x,n=h.lastPoint.y>b.workspaceOrigin.y?h.lastPoint.y:b.workspaceOrigin.y,o=f>b.workspaceOrigin.x?f:b.workspaceOrigin.x,r=g>b.workspaceOrigin.y?g:b.workspaceOrigin.y;h.drawing.graphics.moveTo(m,n),h.drawing.graphics.lineTo(o,r)}"line"===h.state.drawMode?h.lastPoint.mouseInBounds=!0:(h.d.updateCache(k),h.drawing.graphics.clear(),h.lastPoint.x=f,h.lastPoint.y=g,h.lastPoint.mouseInBounds=a.mouseInBounds),np.App.state.update=!0}function k(){var a=this;a.state.drawing=!1,"line"===a.state.drawMode&&(a.d.addChild(a.drawing),a.d.updateCache("source-over"),a.drawing.graphics.clear(),np.App.state.update=!0)}function l(){var b=this,c={w:b.d._cacheWidth,h:b.d._cacheHeight};b.d.uncache(),b.d.cache(0,0,c.w,c.h),np.Workspace.zoomedIn||(a.scaleX=p,a.scaleY=p),np.App.state.update=!0}function m(){var a=this;if(np.App.canvas.width>a.d.cacheCanvas.width||np.App.canvas.heigth>a.d.cacheCanvas.height){var b=np.App.canvas.width>a.d.cacheCanvas.width?np.App.canvas.width:a.d.cacheCanvas.width,c=np.App.canvas.height>a.d.cacheCanvas.height?np.App.canvas.height:a.d.cacheCanvas.height,d=document.createElement("canvas");d.width=b,d.height=c;var e=d.getContext("2d");e.drawImage(a.d.cacheCanvas,0,0),e=a.d.cacheCanvas.getContext("2d"),a.d.cache(0,0,b,c),e.drawImage(d,0,0)}}function n(){var b=this;a.addChild(b.d),"line"===b.state.drawMode&&a.addChild(b.drawing)}var o=$("#drawingmenu"),p=.48,q={red:"#E73C3C",orange:"#FDA100",yellow:"#FFEA00",green:"#01B309",blue:"#0081F7",black:"#252525"};return{$menu:o,init:d,toggle:e,open:f,close:g,setDrawMode:i,setColor:h,draw:j,drawEnd:k,eraseAll:l}}(np.App.stage,np.App.state,np.dbg);var np=np||{};np.Selection=function(a){"use strict";function b(){var b=this;b.items={},b.state={active:!1,drawing:!1,moving:!1,rotating:!1,sliding:!1},b.zoomRatio=.48,b.zoomedIn=!0,b.d=new createjs.Container,b.d.name="selection",b.d.on("pressmove",c,b),b.d.on("pressup",d,b),b.d.js=b,a.addChild(b.d),b.line=null}function c(a){var b=this;b.state.moving===!1&&(b.state.moving=!0,b.zoomedIn?b.d.offset={x:b.d.x-a.stageX,y:b.d.y-a.stageY}:b.d.offset={x:b.d.x-a.stageX/b.zoomRatio,y:b.d.y-a.stageY/b.zoomRatio},b.r&&(b.r.visible=!1)),b.state.moving&&(b.zoomedIn?(b.d.x=a.stageX+b.d.offset.x,b.d.y=a.stageY+b.d.offset.y):(b.d.x=a.stageX/b.zoomRatio+b.d.offset.x,b.d.y=a.stageY/b.zoomRatio+b.d.offset.y),_.each(b.items,function(a){a.d.dispatchEvent("selectionmove")})),np.App.state.update=!0}function d(){var b=this;if(b.state.moving!==!1){if(b.state.moving){var c=new createjs.Event("selectiondrop",!1,!0);a.dispatchEvent(c),b.state.moving=!1,b.d.offset=null}np.App.state.update=!0}}return b.prototype.set=function(a){if(_.isArray(a)){var b=this;if(!createjs.Tween.hasActiveTweens(b.d)){a=a||[];var c=_.difference(_.values(b.items),a),d=_.difference(a,_.values(b.items));c&&b.remove(c),d&&b.append(d)}}},b.prototype.append=function(b){if(_.isArray(b)){var c=this;createjs.Tween.hasActiveTweens(c.d)||(c.state.active||a.addChild(c.d),_.each(b,function(a){c.items[a.id]=a;var b=a.d.parent.localToLocal(a.d.x,a.d.y,c.d);c.d.addChild(a.d),a.d.x=b.x,a.d.y=b.y,a.d.dispatchEvent("itemselect")}),c.state.active=_.size(c.items)>0?!0:!1,a.dispatchEvent("selectionchange"))}},b.prototype.remove=function(b,c){if(_.isArray(b)){var d=this;createjs.Tween.hasActiveTweens(d.d)||(_.each(b,function(b){var e=d.d.localToGlobal(b.d.x,b.d.y);d.zoomedIn||(e.x=e.x/d.zoomRatio,e.y=e.y/d.zoomRatio),a.addChild(b.d),b.d.x=e.x,b.d.y=e.y,c||b.d.dispatchEvent("itemdeselect"),delete d.items[b.id]}),0===_.size(d.items)?d.state.active=!1:a.addChild(d.d),d.d.removeChild(d.r),a.dispatchEvent("selectionchange"))}},b.prototype.deselect=function(a){var b=this;return createjs.Tween.hasActiveTweens(b.d)?!1:(b.remove(_.values(b.items),a),!0)},b.prototype.slide=function(a,b,c){var d=this;d.state.sliding=!0;var e=new createjs.Point(d.d.x+a,d.d.y+b),f=Math.abs(d.d.x-e.x),g=Math.abs(d.d.y-e.y),h=Math.sqrt(f*f+g*g);c||(c=.8*h,c=c>=100?c:100),d.tween=createjs.Tween.get(d.d).to({x:e.x,y:e.y},c),d.tween.addEventListener("change",function(){d.r&&(d.r.visible=!1),np.App.state.update=!0}),d.tween.call(function(){d.tween.removeAllEventListeners("change"),d.state.sliding=!1,np.App.state.update=!0})},b.prototype.find=function(a){var b=this,c=[];return _.each(b.items,function(b){b instanceof a&&c.push(b)}),c},b.prototype.absBounds=function(a){var b,c,d,e,f=this,g=a?f.find(a):_.values(f.items);return _.each(g,function(a){if("function"==typeof a.absBounds){var f=a.absBounds();b=f.x<b||void 0===b?f.x:b,c=f.y<c||void 0===c?f.y:c,d=f.x+f.width>d||!d?f.x+f.width:d,e=f.y+f.height>e||!e?f.y+f.height:e}}),{x:b,y:c,width:d-b,height:e-c}},b.prototype.nudge=function(a){var b=this;switch(a){case"up":b.d.y-=1;break;case"right":b.d.x+=1;break;case"down":b.d.y+=1;break;case"left":b.d.x-=1}np.App.state.update=!0},b.prototype.zoom=function(a){var b=this;"out"==a?b.zoomedIn=!1:b.zoomedIn=!0},b}(np.App.stage);var np=np||{};np.Calculation=function(a){"use strict";function b(){var a=this;a.color=j,a.id=_.uniqueId("calculation_"),a.selected=!1,a.$dialog=n,a.MIN_WIDTH=180,a.HEIGHT=90,a.zoomRatio=1,a.clickCount=0,a.render()}function c(a){var b=o;a.is("#questionMark")?b.textAdd("_"):a.is(".numbers, .operators")?b.textAdd(a.text()):a.is("#backspace")?b.textRemove(1):"space"===a.text()?b.textAdd(" "):"done"===a.text()?b.closeDialog():b.changeColor(a.css("background-color"))}function d(){if(!np.App.state.drawMode){var a=this;a.clickCount>1&&a.edit(),a.clickCount++}}function e(){var a=this;a.edit()}function f(){var a=this;a.select()}function g(){var a=this;a.deselect(),a.closeDialog()}function h(){var a=this;a.tween=createjs.Tween.get(a.d).to({scaleX:.6,scaleY:.6},300,createjs.Ease.getBackIn(6)),a.tween.addEventListener("change",function(){np.App.state.update=!0}),a.tween.call(function(){a.d.parent&&a.d.parent.removeChild(a.d)})}function i(){var a=this;a.clickCount=1}var j="#0081F7",k=20,l=".8",m=.48,n=$("#calculatordialog"),o=null;return n.find(".button").click(function(a){a.preventDefault(),c($(this))}),n.dialog({dialogClass:"no-close calculation-dialog",modal:!0,resizable:!1,draggable:!1,width:260,buttons:[],autoOpen:!1}),b.prototype.add=function(b,c){var j=this,k={};np.Workspace.zoomedIn?(k.x=np.App.canvas.width,k.y=np.App.canvas.height):(k.x=np.App.canvas.width/m,k.y=np.App.canvas.height/m),b=b>np.App.state.workspaceOrigin.x?b:np.App.state.workspaceOrigin.x+10,c=c>np.App.state.workspaceOrigin.y?c:np.App.state.workspaceOrigin.y+10,b=b+j.w>k.x?k.x-j.w-10:b,c=c+j.h>k.y?k.y-j.h-10:c,j.d.x=b,
j.d.y=c,a.addChild(j.d),j.d.on("dblclick",e,j),j.d.on("click",d,j),j.d.on("itemselect",f,j),j.d.on("itemdeselect",g,j),j.d.on("itemdelete",h,j),j.d.on("selectionmove",i,j),j.update()},b.prototype.render=function(){var a=this,b=new createjs.Container;b.name=a.id,b.cursor="pointer",b.mouseChildren=!1;var c=new createjs.Shape;c.graphics.beginFill("rgba(200,200,200,"+l+")").drawRoundRect(0,0,a.MIN_WIDTH,a.HEIGHT,13),c.name="fill",c.x=-a.MIN_WIDTH/2,c.y=-a.HEIGHT/2,a.w=a.MIN_WIDTH,a.h=a.HEIGHT,c.cursor="pointer";var d=new createjs.Text("","300 "+50*a.zoomRatio+"pt Helvetica",a.color);d.name="text",d.y=-d.getMeasuredHeight()/2,d.x=c.x+k,b.addChild(c),b.addChild(d),b.js=a,a.d=b},b.prototype.textAdd=function(a){var b=this,c=b.d.getChildByName("text");c.text=c.text+a,b.update()},b.prototype.textRemove=function(a){var b=this,c=b.d.getChildByName("text");c.text=c.text.length>=1?c.text.slice(0,-a):c.text,b.update()},b.prototype.hasText=function(){var a=this,b=a.d.getChildByName("text");return b.text.length>0},b.prototype.changeColor=function(a){var b=this,c=b.d.getChildByName("text");c.color=a,b.color=a,b.update()},b.prototype.select=function(){var a=this;a.selected=!0,a.clickCount=1,a.update()},b.prototype.deselect=function(){var a=this;a.selected=!1,a.clickCount=0,a.d.getChildByName("fill").shadow=null,a.update()},b.prototype.absBounds=function(){var a=this,b=a.d.localToGlobal(-a.w/2,-a.HEIGHT/2);return{x:b.x,y:b.y,width:a.w,height:a.HEIGHT}},b.prototype.openDialog=function(){var b=this,c=$("#trayDiv").width(),d=$.Event("calculationEdit"),e=b.d.localToGlobal(0,0);e.y=e.y-$("#scrollView").scrollTop();var f,g,h,i;i=np.Workspace.zoomedIn?a.canvas.height*m/2:a.canvas.height/2,e.y>i?(g="center bottom",h="center top",f=b.d.localToGlobal(0,-b.HEIGHT/2+20/(np.Workspace.zoomedIn?1:m)),b.$dialog.addClass("above").removeClass("below")):(g="center top",h="center bottom",f=b.d.localToGlobal(0,b.HEIGHT/2+20/(np.Workspace.zoomedIn?1:m)),b.$dialog.addClass("below").removeClass("above")),np.Workspace.zoomedIn&&(f.x=f.x-$("#scrollView").scrollLeft(),f.y=f.y-$("#scrollView").scrollTop()),f.x+=c,d.pageX=f.x,d.pageY=f.y,b.$dialog.dialog("option","position",{my:g,at:h,of:d,collision:"flipfit"}),b.$dialog.dialog("option","open",function(){$("#calculatordialog_bk").on("click",function(){b.closeDialog()}),$("#calculatordialog_bk").show(),window.setTimeout(function(){$(".ui-widget-overlay").bind("click",function(){$("#calculatordialog_bk").hide(),b.closeDialog()})},400)}),b.$dialog.dialog("open")},b.prototype.closeDialog=function(){var a=this;a.$dialog.dialog("isOpen")&&a.$dialog.dialog("close"),a.hasText()||np.Workspace.deleteSelection(!0)},b.prototype.update=function(){var a=this,b=a.d.getChildByName("text"),c=a.d.getChildByName("fill"),d=b.getMeasuredWidth()>a.MIN_WIDTH-2*k?b.getMeasuredWidth()+2*k:a.MIN_WIDTH;a.w=d,c.x=-a.w/2,b.x=-a.w/2+k;var e=b.text.trim().length>=1&&!a.selected?".01":l,f=a.selected?"rgba(230,230,230,"+e+")":"rgba(200,200,200,"+e+")";c.graphics.clear().beginFill(f).drawRoundRect(0,0,d,a.HEIGHT,13),a.d.cache(-d/2,-a.h/2,d,a.HEIGHT),np.App.state.update=!0},b.prototype.edit=function(){var a=this;a.openDialog(),o=a},b.prototype.duplicate=function(){var a=this,c=new b;c.add(this.d.x+5,this.d.y+5);var d=a.d.getChildByName("text");return c.textAdd(d.text),c.changeColor(a.color),np.Workspace.items[c.id]=c,c},b.prototype.getCenter=function(){var a=this,b=a.absBounds();return{x:b.x+b.width/2,y:b.y+b.height/2}},b}(np.App.stage);var np=np||{};np.Workspace=function(a,b){"use strict";function c(){a.on("stagemousedown",r,np.Workspace),a.on("stagemousemove",s,np.Workspace),a.on("stagemouseup",t,np.Workspace),a.on("mousedown",q,np.Workspace),a.on("itemdelete",u,np.Workspace),a.on("selectiondrop",v,np.Workspace),a.on("drawmodeon",w,np.Workspace)}function d(a){var b=[];return _.each(x,function(c){c instanceof a&&b.push(c)}),b}function e(){var a=y.absBounds(),c=0,d=0;a.x<b.workspaceOrigin.x?c=b.workspaceOrigin.x-a.x+5:a.x+a.width>np.App.canvas.width&&(c=np.App.canvas.width-(a.x+a.width)-z),a.y<b.workspaceOrigin.y?d=b.workspaceOrigin.y-a.y+z:a.y+a.height>np.App.canvas.height&&(d=np.App.canvas.height-(a.y+a.height)-z),(0!==c||0!==d)&&y.slide(c,d)}function f(a,c){return a>b.workspaceOrigin.x&&a<np.App.canvas.width&&c>b.workspaceOrigin.y&&c<np.App.canvas.height?!0:!1}function g(a){var b=new createjs.Event("itemdelete",!0,!0);a.d.dispatchEvent(b)}function h(a){var b=_.values(y.items);y.deselect(a)&&_.each(b,function(a){g(a)})}function i(){var a=x;y.deselect(),_.each(a,function(a){g(a)}),np.Drawtool.setColor("red"),np.Drawtool.close(),np.Drawtool.eraseAll()}function j(a){var c=new createjs.Point(b.mouse.lastClick.x,b.mouse.lastClick.y),d=new np.Calculation;x[d.id]=d;var e={x:$("#scrollView").scrollLeft(),y:$("#scrollView").scrollTop(),w:$("#scrollView").width(),h:$("#scrollView").height()};c.x=b.mouse.lastClick.x>b.workspaceOrigin.x?b.mouse.lastClick.x:Math.floor(e.x+e.w/2),c.y=b.mouse.lastClick.y>b.workspaceOrigin.y?b.mouse.lastClick.y:Math.floor(e.y+e.h/2),(c.x<e.x||c.x>e.x+e.w||c.y<e.y||c.y>e.y+e.h)&&(c.x=Math.floor(e.x+e.w/2),c.y=Math.floor(e.y+e.h/2)),1!=a&&(c.x=c.x/a,c.y=c.y/a),d.add(c.x,c.y),y.set([d]),d.edit()}function k(a,b){var c=this;"out"==b?c.zoomedIn=!1:c.zoomedIn=!0,y.zoom(b)}function l(){y.set(_.values(x))}function m(a){var b;switch(a){case 37:b="left";break;case 38:b="up";break;case 39:b="right";break;case 40:b="down";break;default:return}y.nudge(b)}function n(a){var c=null,d={x:a.stageX,y:a.stageY};switch(a.type){case"stagemousedown":c=o(d),b.proxyTarget=c;break;case"stagemouseup":c=b.proxyTarget,b.proxyTarget=null;break;case"stagemousemove":c=b.proxyTarget}c&&(a=$.event.fix(a.nativeEvent),a.target=c,$(c).trigger(a))}function o(a){for(var b=null,c=[".shadeDrag:visible","#shade:visible","#workspace"];!b&&c.length>0;){var d=c.shift();$(d).each(function(){return p(this,a)?(b=this,!1):void 0})}return b?b:!1}function p(a,b){var c=$(a),d=($("#scrollView"),{x:c.offset().left+$("#scrollView").scrollLeft(),y:c.offset().top+$("#scrollView").scrollTop(),width:c.width(),height:c.height()});return"workspace"==$(a).attr("id")&&(d.x=0),d.x+d.width<b.x||d.y+d.height<b.y||b.x<d.x||b.y<d.y?!1:!0}function q(a){if(!np.App.state.drawMode){var b=a.target.js;b instanceof np.Calculation&&(a.nativeEvent.shiftKey||a.nativeEvent.ctrlKey||a.nativeEvent.metaKey?_.has(y.items,b.id)?y.remove([b]):y.append([b]):y.items[b.id]||y.set([b]))}}function r(c){var d=this;b.mouse.down=!0,b.mouse.lastClick={x:Math.floor(c.stageX),y:Math.floor(c.stageY)};var e={};if(d.zoomedIn?(e.x=c.stageX,e.y=c.stageY):(e.x=c.stageX/.48,e.y=c.stageY/.48),b.drawMode){var f=!1;return"touchmove"==c.nativeEvent.type&&(f=!0),void np.Drawtool.draw({x:c.stageX,y:c.stageY},d.zoomedIn,f)}a.getObjectUnderPoint(e.x,e.y)||(y.deselect(),n(c))}function s(a){var c=this;if(b.mouse.down&&b.drawMode){var d=!1;return"touchmove"==a.nativeEvent.type&&(d=!0),void np.Drawtool.draw({x:a.stageX,y:a.stageY},c.zoomedIn,d)}var e=$.event.fix(a.nativeEvent);e.target=$("#canvas")[0],e.type="wk_mousemove",e.offsetX=a.stageX,e.offsetY=a.stageY,0==Object.keys(np.Workspace.selection.items).length&&$("#canvas").trigger(e),n(a)}function t(a){return b.mouse.down=!1,b.drawMode?void np.Drawtool.drawEnd():void n(a)}function u(a){var b=a.target.js;delete x[b.id]}function v(){e()}function w(){y.deselect()}var x={},y=new np.Selection(x),z=5,A=!0;return{init:c,selection:y,items:x,find:d,deleteSelection:h,deleteAll:i,selectAll:l,removeItem:g,addCalculation:j,boundsCheck:e,inBounds:f,handleArrow:m,zoom:k,zoomedIn:A}}(np.App.stage,np.App.state),$(document).ready(function(){np.App.init()});